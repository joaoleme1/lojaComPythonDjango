{% extends "base.html" %}
{% block title %}Carrinho · Minha Loja{% endblock %}
{% block content %}

<h1 class="h4 mb-3">Seu carrinho</h1>

{% if itens %}
  <div class="table-responsive">
    <table class="table align-middle">
      <thead>
        <tr>
          <th>Produto</th>
          <th class="text-end">Preço</th>
          <th style="width:160px">Quantidade</th>
          <th class="text-end">Subtotal</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for i in itens %}
          <tr>
            <td>
              <div class="d-flex align-items-center">
                {% if i.imagem %}
                  <img src="{{ i.imagem }}" alt="" class="me-2" style="width:56px;height:56px;object-fit:cover;border-radius:8px;">
                {% endif %}
                <div>
                  <div class="fw-medium"><a href="{% url 'detalhe_produto' i.produto_id %}">{{ i.nome }}</a></div>
                  <div class="text-muted small">ID {{ i.produto_id }}</div>
                </div>
              </div>
            </td>
            <td class="text-end">R$ {{ i.preco }}</td>
            <td>
              <form method="post" action="{% url 'atualizar_quantidade' i.produto_id %}" class="d-flex gap-2">
                {% csrf_token %}
                <input type="number" name="quantidade" value="{{ i.quantidade }}" min="1" step="1" class="form-control" style="max-width:90px;">
                <button class="btn btn-outline-secondary" type="submit">Atualizar</button>
              </form>
            </td>
            <td class="text-end fw-semibold">R$ {{ i.subtotal }}</td>
            <td class="text-end">
              <a class="btn btn-link text-danger" href="{% url 'remover_do_carrinho' i.produto_id %}">Remover</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <th colspan="3" class="text-end">Total</th>
          <th class="text-end h5">R$ {{ total }}</th>
          <th></th>
        </tr>
      </tfoot>
    </table>
  </div>

  <div class="d-flex justify-content-between">
    <a class="btn btn-outline-secondary" href="{% url 'lista_produtos' %}">↩ Continuar comprando</a>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-danger" href="{% url 'limpar_carrinho' %}">Limpar carrinho</a>
      <a class="btn btn-success" href="#">Finalizar compra</a> 
    </div>
  </div>
{% else %}
  <div class="alert alert-info">Seu carrinho está vazio.</div>
  <a class="btn btn-primary" href="{% url 'lista_produtos' %}">Ver produtos</a>
{% endif %}

{% endblock %}
